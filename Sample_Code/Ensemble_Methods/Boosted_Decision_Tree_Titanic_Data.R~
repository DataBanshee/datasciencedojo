###################################################################################
## This code is part of Data Science Dojo's bootcamp
## Copyright (C) 2015

## Objective: Machine learning of Titanic data's survival classification with ensemble methods (random forest and boosted decision tree)
## Data source: Titanic data set
##              at: https://github.com/datasciencedojo/bootcamp/tree/master/Ensemble_Methods
## Please install "bst" package: install.packages("bst")
###################################################################################

## load the rpart library
library(bst)

## DATA EXPLORATION AND CLEANING
## load the iris data in R
titanic.data <- read.csv("Titanic_train.csv", header=TRUE)
## explore the data set
dim(titanic.data)
str(titanic.data)
summary(titanic.data)
## ignore the PassengerID, Name, Ticket, and Cabin
titanic.data <- titanic.data[, -c(1, 4, 9, 11)]
## replace all 0 in Survived to -1, to consistent with the bst library
titanic.data[titanic.data$Survived == 0, "Survived"] <- -1
## there are some NAs in Age, fill it with the median value
titanic.data$Age[is.na(titanic.data$Age)] = median(titanic.data$Age, na.rm=TRUE)

## BUILD MODEL
## randomly choose 80% of the data set as training data
random.rows.train <- sample(1:nrow(titanic.data), 0.8*nrow(titanic.data), replace=F)
titanic.train <- titanic.data[random.rows.train,]
dim(titanic.train)
## select the other 20% as the testing data
random.rows.test <- setdiff(1:nrow(titanic.data),random.rows.train)
titanic.test <- titanic.data[random.rows.test,]
dim(titanic.test)
## fitting decision model on training set
titanic.model <- bst(titanic.train[,2:8], titanic.train$Survived, learner = "tree")
titanic.model

## MODEL EVALUATION
## to predict using logistic regression model, probablilities obtained
titanic.test.predictions <- predict(titanic.model, titanic.test, type="response")
## extract out the observation for titanic.testing dataset
titanic.test.observations <- titanic.test[,1]
## show the confusion table
confusion.matrix <- table(titanic.test.predictions, titanic.test.observations)
confusion.matrix
## calculate the error in testing set
error <- (confusion.matrix[1, 2] + confusion.matrix[2, 1]) / sum(confusion.matrix)
error

